*** AbsListView.smali	2013-08-01 13:21:45.936320869 +0000
--- AbsListView.smali	2013-08-01 13:20:34.089651873 +0000
***************
*** 29,35 ****
          Landroid/widget/AbsListView$ListItemAccessibilityDelegate;,
          Landroid/widget/AbsListView$SavedState;,
          Landroid/widget/AbsListView$SelectionBoundsAdjuster;,
!         Landroid/widget/AbsListView$OnScrollListener;
      }
  .end annotation
  
--- 29,36 ----
          Landroid/widget/AbsListView$ListItemAccessibilityDelegate;,
          Landroid/widget/AbsListView$SavedState;,
          Landroid/widget/AbsListView$SelectionBoundsAdjuster;,
!         Landroid/widget/AbsListView$OnScrollListener;,
!         Landroid/widget/AbsListView$Injector;
      }
  .end annotation
  
***************
*** 1973,1981 ****
      move-result v1
  
      .local v1, pointerId:I
!     iget v4, p0, Landroid/widget/AbsListView;->mActivePointerId:I
  
!     if-ne v1, v4, :cond_0
  
      if-nez v2, :cond_1
  
--- 2113,2123 ----
      move-result v1
  
      .local v1, pointerId:I
!     invoke-direct {p0, v1}, Landroid/widget/AbsListView;->handleSecondaryPointerUp(I)Z
! 
!     move-result v4
  
!     if-eqz v4, :cond_0
  
      if-nez v2, :cond_1
  
***************
*** 2407,2413 ****
  
      sub-int v4, v23, v22
  
!     sub-int v5, v3, v4
  
      .local v5, overscroll:I
      const/4 v4, 0x0
--- 2549,2565 ----
  
      sub-int v4, v23, v22
  
!     sub-int/2addr v3, v4
! 
!     move-object/from16 v0, p0
! 
!     iget v4, v0, Landroid/widget/AbsListView;->mScrollY:I
! 
!     move-object/from16 v0, p0
! 
!     invoke-static {v0, v3, v4}, Landroid/widget/AbsListView$Injector;->scaleOverScrollDeltaY(Landroid/widget/AbsListView;II)I
! 
!     move-result v5
  
      .local v5, overscroll:I
      const/4 v4, 0x0
***************
*** 2730,2735 ****
      add-int v18, v18, v8
  
      :goto_5
      if-eqz v8, :cond_14
  
      const/4 v7, 0x0
--- 2884,2899 ----
      add-int v18, v18, v8
  
      :goto_5
+     move-object/from16 v0, p0
+ 
+     iget v3, v0, Landroid/widget/AbsListView;->mScrollY:I
+ 
+     move-object/from16 v0, p0
+ 
+     invoke-static {v0, v8, v3}, Landroid/widget/AbsListView$Injector;->scaleOverScrollDeltaY(Landroid/widget/AbsListView;II)I
+ 
+     move-result v8
+ 
      if-eqz v8, :cond_14
  
      const/4 v7, 0x0
***************
*** 5171,5176 ****
      return v0
  .end method
  
  .method public getCheckedItemCount()I
      .locals 1
  
--- 5419,5446 ----
      return v0
  .end method
  
+ .method protected getCheckedIdStates()Landroid/util/LongSparseArray;
+     .locals 1
+     .annotation build Landroid/annotation/MiuiHook;
+         value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+     .end annotation
+ 
+     .annotation system Ldalvik/annotation/Signature;
+         value = {
+             "()",
+             "Landroid/util/LongSparseArray",
+             "<",
+             "Ljava/lang/Integer;",
+             ">;"
+         }
+     .end annotation
+ 
+     .prologue
+     iget-object v0, p0, Landroid/widget/AbsListView;->mCheckedIdStates:Landroid/util/LongSparseArray;
+ 
+     return-object v0
+ .end method
+ 
  .method public getCheckedItemCount()I
      .locals 1
  
***************
*** 8508,8515 ****
  .method public onTouchEvent(Landroid/view/MotionEvent;)Z
      .locals 29
      .parameter "ev"
  
      .prologue
      invoke-virtual/range {p0 .. p0}, Landroid/widget/AbsListView;->isEnabled()Z
  
      move-result v26
--- 8810,8835 ----
  .method public onTouchEvent(Landroid/view/MotionEvent;)Z
      .locals 29
      .parameter "ev"
+     .annotation build Landroid/annotation/MiuiHook;
+         value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+     .end annotation
  
      .prologue
+     invoke-static/range {p0 .. p1}, Landroid/widget/AbsListView$Injector;->isOutOfTouchRange(Landroid/widget/AbsListView;Landroid/view/MotionEvent;)Z
+ 
+     move-result v26
+ 
+     if-eqz v26, :cond_miui_0
+ 
+     const/16 v26, 0x3
+ 
+     move-object/from16 v0, p1
+ 
+     move/from16 v1, v26
+ 
+     invoke-virtual {v0, v1}, Landroid/view/MotionEvent;->setAction(I)V
+ 
+     :cond_miui_0
      invoke-virtual/range {p0 .. p0}, Landroid/widget/AbsListView;->isEnabled()Z
  
      move-result v26
***************
*** 9972,9984 ****
  
      if-nez v26, :cond_1f
  
!     new-instance v26, Landroid/widget/AbsListView$FlingRunnable;
! 
!     move-object/from16 v0, v26
! 
!     move-object/from16 v1, p0
  
!     invoke-direct {v0, v1}, Landroid/widget/AbsListView$FlingRunnable;-><init>(Landroid/widget/AbsListView;)V
  
      move-object/from16 v0, v26
  
--- 10294,10302 ----
  
      if-nez v26, :cond_1f
  
!     invoke-direct/range {p0 .. p0}, Landroid/widget/AbsListView;->createFlingRunnable()Landroid/widget/AbsListView$FlingRunnable;
  
!     move-result-object v26
  
      move-object/from16 v0, v26
  
***************
*** 10096,10108 ****
  
      if-nez v26, :cond_23
  
!     new-instance v26, Landroid/widget/AbsListView$FlingRunnable;
! 
!     move-object/from16 v0, v26
! 
!     move-object/from16 v1, p0
  
!     invoke-direct {v0, v1}, Landroid/widget/AbsListView$FlingRunnable;-><init>(Landroid/widget/AbsListView;)V
  
      move-object/from16 v0, v26
  
--- 10414,10422 ----
  
      if-nez v26, :cond_23
  
!     invoke-direct/range {p0 .. p0}, Landroid/widget/AbsListView;->createFlingRunnable()Landroid/widget/AbsListView$FlingRunnable;
  
!     move-result-object v26
  
      move-object/from16 v0, v26
  
***************
*** 10167,10187 ****
  
      invoke-virtual {v0, v1}, Landroid/widget/AbsListView;->reportScrollStateChange(I)V
  
!     invoke-static {v15}, Ljava/lang/Math;->abs(I)I
  
      move-result v26
  
!     move-object/from16 v0, p0
! 
!     iget v0, v0, Landroid/widget/AbsListView;->mMinimumVelocity:I
! 
!     move/from16 v27, v0
! 
!     move/from16 v0, v26
! 
!     move/from16 v1, v27
! 
!     if-le v0, v1, :cond_24
  
      move-object/from16 v0, p0
  
--- 10481,10491 ----
  
      invoke-virtual {v0, v1}, Landroid/widget/AbsListView;->reportScrollStateChange(I)V
  
!     invoke-virtual/range {p0 .. p0}, Landroid/widget/AbsListView;->isSpringOverScrollEnabled()Z
  
      move-result v26
  
!     if-eqz v26, :cond_24
  
      move-object/from16 v0, p0
  
***************
*** 10200,10210 ****
      :cond_24
      move-object/from16 v0, p0
  
!     iget-object v0, v0, Landroid/widget/AbsListView;->mFlingRunnable:Landroid/widget/AbsListView$FlingRunnable;
! 
!     move-object/from16 v26, v0
! 
!     invoke-virtual/range {v26 .. v26}, Landroid/widget/AbsListView$FlingRunnable;->startSpringback()V
  
      goto/16 :goto_4
  
--- 10504,10510 ----
      :cond_24
      move-object/from16 v0, p0
  
!     invoke-direct {v0, v15}, Landroid/widget/AbsListView;->startFlingRunnable(I)V
  
      goto/16 :goto_4
  
***************
*** 10339,10351 ****
  
      if-nez v26, :cond_28
  
!     new-instance v26, Landroid/widget/AbsListView$FlingRunnable;
  
!     move-object/from16 v0, v26
! 
!     move-object/from16 v1, p0
! 
!     invoke-direct {v0, v1}, Landroid/widget/AbsListView$FlingRunnable;-><init>(Landroid/widget/AbsListView;)V
  
      move-object/from16 v0, v26
  
--- 10639,10647 ----
  
      if-nez v26, :cond_28
  
!     invoke-direct/range {p0 .. p0}, Landroid/widget/AbsListView;->createFlingRunnable()Landroid/widget/AbsListView$FlingRunnable;
  
!     move-result-object v26
  
      move-object/from16 v0, v26
  
***************
*** 12765,12773 ****
  
      if-nez v0, :cond_0
  
!     new-instance v0, Landroid/widget/AbsListView$FlingRunnable;
  
!     invoke-direct {v0, p0}, Landroid/widget/AbsListView$FlingRunnable;-><init>(Landroid/widget/AbsListView;)V
  
      iput-object v0, p0, Landroid/widget/AbsListView;->mFlingRunnable:Landroid/widget/AbsListView$FlingRunnable;
  
--- 13074,13082 ----
  
      if-nez v0, :cond_0
  
!     invoke-direct {p0}, Landroid/widget/AbsListView;->createFlingRunnable()Landroid/widget/AbsListView$FlingRunnable;
  
!     move-result-object v0
  
      iput-object v0, p0, Landroid/widget/AbsListView;->mFlingRunnable:Landroid/widget/AbsListView$FlingRunnable;
  
***************
*** 13626,13634 ****
  
      if-nez v5, :cond_0
  
!     new-instance v5, Landroid/widget/AbsListView$FlingRunnable;
  
!     invoke-direct {v5, p0}, Landroid/widget/AbsListView$FlingRunnable;-><init>(Landroid/widget/AbsListView;)V
  
      iput-object v5, p0, Landroid/widget/AbsListView;->mFlingRunnable:Landroid/widget/AbsListView$FlingRunnable;
  
--- 13951,13959 ----
  
      if-nez v5, :cond_0
  
!     invoke-direct {p0}, Landroid/widget/AbsListView;->createFlingRunnable()Landroid/widget/AbsListView$FlingRunnable;
  
!     move-result-object v5
  
      iput-object v5, p0, Landroid/widget/AbsListView;->mFlingRunnable:Landroid/widget/AbsListView$FlingRunnable;
  
***************
*** 14484,14489 ****
  
      iput-boolean v0, v1, Landroid/widget/AbsListView;->mBlockLayoutRequests:Z
  
      if-lez v10, :cond_e
  
      move-object/from16 v0, p0
--- 14809,14818 ----
  
      iput-boolean v0, v1, Landroid/widget/AbsListView;->mBlockLayoutRequests:Z
  
+     move-object/from16 v0, p0
+ 
+     invoke-direct {v0, v11, v10}, Landroid/widget/AbsListView;->calcFirstPosition(ZI)V
+ 
      if-lez v10, :cond_e
  
      move-object/from16 v0, p0
***************
*** 14516,14522 ****
  
      invoke-virtual {v0, v1}, Landroid/widget/AbsListView;->offsetChildrenTopAndBottom(I)V
  
!     if-eqz v11, :cond_10
  
      move-object/from16 v0, p0
  
--- 14845,14853 ----
  
      invoke-virtual {v0, v1}, Landroid/widget/AbsListView;->offsetChildrenTopAndBottom(I)V
  
!     sget-boolean v29, Landroid/widget/AbsListView$Injector;->FALSE:Z
! 
!     if-eqz v29, :cond_10
  
      move-object/from16 v0, p0
  

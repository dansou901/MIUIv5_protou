*** PowerManagerService.smali	2013-07-31 22:21:06.960726845 +0000
--- PowerManagerService.smali	2013-07-31 22:22:01.787398088 +0000
***************
*** 37,47 ****
  
  .field static final AUTOBRIGHTNESS_ANIM_STEPS:I = 0x78
  
! .field static final AUTODIMNESS_ANIM_STEPS:I = 0x78
!     .annotation build Landroid/annotation/MiuiHook;
!         value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
!     .end annotation
! .end field
  
  .field private static final BATTERY_LOW_BIT:I = 0x10
  
--- 36,42 ----
  
  .field static final AUTOBRIGHTNESS_ANIM_STEPS:I = 0x78
  
! .field static final AUTODIMNESS_ANIM_STEPS:I = 0x147ae1
  
  .field private static final BATTERY_LOW_BIT:I = 0x10
  
***************
*** 1930,1938 ****
  
  .method private enableProximityLockLocked()V
      .locals 6
-     .annotation build Landroid/annotation/MiuiHook;
-         value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
-     .end annotation
  
      .prologue
      iget-boolean v2, p0, Lcom/android/server/PowerManagerService;->mProximitySensorEnabled:Z
--- 1925,1930 ----
  
  .method private enableProximityLockLocked()V
      .locals 6
  
      .prologue
      iget-boolean v2, p0, Lcom/android/server/PowerManagerService;->mProximitySensorEnabled:Z
***************
*** 1964,1970 ****
      invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V
  
      .end local v0           #identity:J
!     :goto_0
      return-void
  
      .restart local v0       #identity:J
--- 1956,1962 ----
      invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V
  
      .end local v0           #identity:J
!     :cond_0
      return-void
  
      .restart local v0       #identity:J
***************
*** 1974,1987 ****
      invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V
  
      throw v2
- 
-     .end local v0           #identity:J
-     :cond_0
-     iget-boolean v2, p0, Lcom/android/server/PowerManagerService;->mProximitySensorActive:Z
- 
-     invoke-direct {p0, v2}, Lcom/android/server/PowerManagerService;->proximityChangedLocked(Z)V
- 
-     goto :goto_0
  .end method
  
  .method private forceReenableScreen()V
--- 1966,1971 ----
      invoke-static {v0, v1}, Landroid/os/Binder;->restoreCallingIdentity(J)V
  
      throw v2
  .end method
  
  .method private forceReenableScreen()V
***************
*** 2828,2834 ****
      throw v4
  
      :cond_7
!     const/16 v3, 0x78
  
      .restart local v3       #steps:I
      goto :goto_3
--- 2808,2814 ----
      throw v4
  
      :cond_7
!     const v3, 0x147ae1
  
      .restart local v3       #steps:I
      goto :goto_3
***************
*** 3463,3471 ****
      .parameter "newState"
      .parameter "noChangeLights"
      .parameter "reason"
-     .annotation build Landroid/annotation/MiuiHook;
-         value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
-     .end annotation
  
      .prologue
      iget-object v10, p0, Lcom/android/server/PowerManagerService;->mLocks:Lcom/android/server/PowerManagerService$LockList;
--- 3443,3448 ----
      .parameter "newState"
      .parameter "noChangeLights"
      .parameter "reason"
  
      .prologue
      iget-object v10, p0, Lcom/android/server/PowerManagerService;->mLocks:Lcom/android/server/PowerManagerService$LockList;
***************
*** 4144,4152 ****
  .method private setScreenStateLocked(Z)I
      .locals 4
      .parameter "on"
-     .annotation build Landroid/annotation/MiuiHook;
-         value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
-     .end annotation
  
      .prologue
      const/4 v3, 0x0
--- 4123,4128 ----
  .method private setScreenStateLocked(Z)I
      .locals 4
      .parameter "on"
  
      .prologue
      const/4 v3, 0x0
***************
*** 4172,4178 ****
  
      const/4 v2, 0x2
  
!     invoke-static {p0, v1, v3, v2, v3}, Lcom/android/server/PowerManagerService$Injector;->animateTo(Lcom/android/server/PowerManagerService;Lcom/android/server/PowerManagerService$ScreenBrightnessAnimator;III)V
  
      :cond_1
      invoke-static {p1}, Lcom/android/server/PowerManagerService;->nativeSetScreenState(Z)I
--- 4148,4154 ----
  
      const/4 v2, 0x2
  
!     invoke-virtual {v1, v3, v2, v3}, Lcom/android/server/PowerManagerService$ScreenBrightnessAnimator;->animateTo(III)V
  
      :cond_1
      invoke-static {p1}, Lcom/android/server/PowerManagerService;->nativeSetScreenState(Z)I
***************
*** 5184,5192 ****
      .parameter "eventType"
      .parameter "force"
      .parameter "ignoreIfScreenOff"
-     .annotation build Landroid/annotation/MiuiHook;
-         value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
-     .end annotation
  
      .prologue
      iget v1, p0, Lcom/android/server/PowerManagerService;->mPokey:I
--- 5160,5165 ----
      .parameter "eventType"
      .parameter "force"
      .parameter "ignoreIfScreenOff"
  
      .prologue
      iget v1, p0, Lcom/android/server/PowerManagerService;->mPokey:I
***************
*** 5279,5285 ****
  
      if-eqz v1, :cond_6
  
!     sget-boolean v1, Lcom/android/server/PowerManagerService$Injector;->FALSE:Z
  
      if-eqz v1, :cond_7
  
--- 5256,5262 ----
  
      if-eqz v1, :cond_6
  
!     iget-boolean v1, p0, Lcom/android/server/PowerManagerService;->mProximitySensorActive:Z
  
      if-eqz v1, :cond_7
  
***************
*** 5516,5524 ****
      .parameter "pid"
      .parameter "tag"
      .parameter "ws"
-     .annotation build Landroid/annotation/MiuiHook;
-         value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
-     .end annotation
  
      .prologue
      if-eqz p6, :cond_0
--- 5493,5498 ----
      .parameter "pid"
      .parameter "tag"
      .parameter "ws"
  
      .prologue
      if-eqz p6, :cond_0
***************
*** 5825,5830 ****
  
      if-nez v2, :cond_e
  
      .end local v11           #oldWakeLockState:I
      :cond_e
      :goto_6
--- 5799,5808 ----
  
      if-nez v2, :cond_e
  
+     const/4 v2, 0x0
+ 
+     iput-boolean v2, p0, Lcom/android/server/PowerManagerService;->mProximitySensorActive:Z
+ 
      .end local v11           #oldWakeLockState:I
      :cond_e
      :goto_6
***************
*** 7919,7960 ****
      return-object v0
  .end method
  
- .method getPowerState()I
-     .locals 1
-     .annotation build Landroid/annotation/MiuiHook;
-         value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
-     .end annotation
- 
-     .prologue
-     iget v0, p0, Lcom/android/server/PowerManagerService;->mPowerState:I
- 
-     return v0
- .end method
- 
- .method getProximitySensorActive()Z
-     .locals 1
-     .annotation build Landroid/annotation/MiuiHook;
-         value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
-     .end annotation
- 
-     .prologue
-     iget-boolean v0, p0, Lcom/android/server/PowerManagerService;->mProximitySensorActive:Z
- 
-     return v0
- .end method
- 
- .method getScreenBrightnessHandler()Landroid/os/Handler;
-     .locals 1
-     .annotation build Landroid/annotation/MiuiHook;
-         value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
-     .end annotation
- 
-     .prologue
-     iget-object v0, p0, Lcom/android/server/PowerManagerService;->mScreenBrightnessHandler:Landroid/os/Handler;
- 
-     return-object v0
- .end method
- 
  .method getStayOnConditionsLocked()I
      .locals 2
  
--- 7881,7886 ----
      return-object v0
  .end method
  
  .method getStayOnConditionsLocked()I
      .locals 2
  
